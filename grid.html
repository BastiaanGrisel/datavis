<html>
<head>
	<script src="d3.min.js" type="text/javascript"></script>
	<link rel="stylesheet" type="text/css" href="grid.css">
</head>
<body>
	<div class="flex_column">
		<div id="control_container">
			<select id="matches">
				{% for match in matches %}
				  <option value="{{match}}" {% if match == selected_match %}selected{% endif %}>{{match}}</option>
				{% endfor %}
			</select>
			<select id="start_time">
				{% for timepoint in timepoints %}
				  <option value="{{timepoint}}" {% if timepoint == selected_timepoint %}selected{% endif %}>{{timepoint}}</option>
				{% endfor %}
			</select>
			<select id="end_time">
				{% for timepoint in timepoints %}
				  <option value="{{timepoint}}" {% if timepoint == selected_timepoint %}selected{% endif %}>{{timepoint}}</option>
				{% endfor %}
			</select>
		</div>
		<div id="svg_container">
		</div>
	</div>

	<script src="grid.js" type="text/javascript"></script>
	<script>
		// Populate grid
		var baseurl 	= "http://localhost:8888/";

		var match_el 		= document.getElementById('matches'),
			start_time_el 	= document.getElementById('start_time'),
			end_time_el		= document.getElementById('end_time');

		var match 		= match_el.options[match_el.selectedIndex].value,
			start_time 	= start_time_el.options[start_time_el.selectedIndex].value;
			end_time 	= end_time_el.options[end_time_el.selectedIndex].value;

		d3.json(baseurl + "locations/" + match + "/" + start_time + "/" + end_time, function (json) {
			tiles = [];

			json.forEach(function(player) {
				tiles.push(new Tile(player.x, player.y, player.team))
			});
			
			updateGrid(tiles);
        });

        // Check for changes in select boxes
        d3.select("#matches").on("change", function(){ 
			var selected_match = match_el.options[match_el.selectedIndex].value;

			d3.json(baseurl + "timepoints/" + selected_match, function (json) {
				// Remove current times
				while (start_time_el.firstChild) {
				    start_time_el.removeChild(start_time_el.firstChild);
				}

				json.forEach(function(timepoint) {
					var option = new Option(timepoint, timepoint);
					start_time_el.appendChild(option);
				});
	        });
        });	

        d3.select("#start_time").on("change", loadTiles);	
        d3.select("#end_time").on("change", loadTiles);	

        function loadTiles() { 
			var selected_start_time 		= start_time_el.options[start_time_el.selectedIndex].value;
			var selected_end_time 			= end_time_el.options[end_time_el.selectedIndex].value;

			console.log(baseurl + "locations/" + match + "/" + selected_start_time + "/" + selected_end_time)

			d3.json(baseurl + "locations/" + match + "/" + selected_start_time + "/" + selected_end_time, function (json) {
				tiles = [];
				
				json.forEach(function(player) {
					tiles.push(new Tile(player.x, player.y, player.team))
				});
				
				updateGrid(tiles);
	        });
		}
	</script>
</body>
</html>