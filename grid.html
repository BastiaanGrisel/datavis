<html>
<head>
	<script src="d3.min.js" type="text/javascript"></script>
	<link rel="stylesheet" type="text/css" href="grid.css">
</head>
<body>
	<div class="flex_column">
		<div id="control_container">
			<select id="matches">
				{% for match in matches %}
				  <option value="{{match}}" {% if match == selected_match %}selected{% endif %}>{{match}}</option>
				{% endfor %}
			</select>
			<input type="number" id="start_time" value="{{selected_timepoint}}" min="{{min_time}}" max="{{max_time}}" />
			<input type="number" id="offset" value="0" />
		</div>
		<div id="svg_container">
		</div>
	</div>

	<script>
		baseurl 	  = "http://localhost/";
		canvas_width  = document.getElementById("svg_container").clientWidth;
		canvas_height = document.getElementById("svg_container").clientHeight;

		red_team = [];  //dire
		blue_team = []; //radiant
		all_players = [];

	</script>

	<script src="grid.js" type="text/javascript"></script>
	<script src="players.js" type="text/javascript"></script>

	<script src="danger.js" type="text/javascript"></script>
	<script src="dangergraph.js" type="text/javascript"></script>

	<script src="distance.js" type="text/javascript"></script>
	<script src="distancegraph.js" type="text/javascript"></script>

	<script>
		// Initialisation code

		// Event handlers
		d3.select("#matches").on("change", onChangeMatch);
		d3.select("#start_time").on("change", onChangeTime);	
        d3.select("#offset").on("change", onChangeTime);	

		function onChangeMatch() {
			// Populate Timepoints and player positions
			// d3.json(baseurl + "timepoints/" + selected_match, function (json) {
			// 	getPlayerPositions();
	  //       });

	  //       // Draw distance graph
	  //       d3.json(baseurl + "distances/" + selected_match, function (json) {
			// 	drawDistanceGraph(json);
	  //       });
		}

		function onChangeTime() {
			d3.json(baseurl + "locations/" + getSelectedMatch() + "/" + getSelectedTime() + "/" + (getSelectedTime()+getSelectedOffset()), function (json) {

				all_players = json.filter(function(player) { return player.tsync == getSelectedTime(); });
				red_team 	= all_players.filter(function(player) { return player.team == "dire"; })
				blue_team 	= all_players.filter(function(player) { return player.team == "radiant"; })

				// findPOI(25, 2);  players and teams are global, range 10, more then 3 players 
				// updateGrid(tiles);
			})
		}

		// Utility functions
		function getSelectedMatch() {
			var match_el 		= document.getElementById('matches');
			return parseInt(match_el.options[match_el.selectedIndex].value);
		}

		function getSelectedTime() {
			return document.getElementById('start_time').value;
		}

		function getSelectedOffset() {
			return document.getElementById('offset').value;
		}
	</script>
</body>
</html>